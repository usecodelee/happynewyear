(function(t){function e(e){for(var r,o,c=e[0],s=e[1],u=e[2],l=0,d=[];l<c.length;l++)o=c[l],Object.prototype.hasOwnProperty.call(a,o)&&a[o]&&d.push(a[o][0]),a[o]=0;for(r in s)Object.prototype.hasOwnProperty.call(s,r)&&(t[r]=s[r]);f&&f(e);while(d.length)d.shift()();return i.push.apply(i,u||[]),n()}function n(){for(var t,e=0;e<i.length;e++){for(var n=i[e],r=!0,c=1;c<n.length;c++){var s=n[c];0!==a[s]&&(r=!1)}r&&(i.splice(e--,1),t=o(o.s=n[0]))}return t}var r={},a={app:0},i=[];function o(e){if(r[e])return r[e].exports;var n=r[e]={i:e,l:!1,exports:{}};return t[e].call(n.exports,n,n.exports,o),n.l=!0,n.exports}o.m=t,o.c=r,o.d=function(t,e,n){o.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:n})},o.r=function(t){"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},o.t=function(t,e){if(1&e&&(t=o(t)),8&e)return t;if(4&e&&"object"===typeof t&&t&&t.__esModule)return t;var n=Object.create(null);if(o.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var r in t)o.d(n,r,function(e){return t[e]}.bind(null,r));return n},o.n=function(t){var e=t&&t.__esModule?function(){return t["default"]}:function(){return t};return o.d(e,"a",e),e},o.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},o.p="";var c=window["webpackJsonp"]=window["webpackJsonp"]||[],s=c.push.bind(c);c.push=e,c=c.slice();for(var u=0;u<c.length;u++)e(c[u]);var f=s;i.push([0,"chunk-vendors"]),n()})({0:function(t,e,n){t.exports=n("56d7")},"02e4":function(t,e,n){},1:function(t,e){},2:function(t,e){},3:function(t,e){},"37f7":function(t,e,n){t.exports=n.p+"img/2.f24fc20f.jpg"},"56d7":function(t,e,n){"use strict";n.r(e);n("e260"),n("e6cf"),n("cca6"),n("a79d");var r=n("2b0e"),a=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",{attrs:{id:"app"}},[n("router-view")],1)},i=[],o=(n("5c0b"),n("2877")),c={},s=Object(o["a"])(c,a,i,!1,null,null,null),u=s.exports,f=n("8c4f"),l=function(){var t=this,e=t.$createElement,r=t._self._c||e;return r("section",[r("img",{directives:[{name:"show",rawName:"v-show",value:!1,expression:"false"}],ref:"hatimg",attrs:{src:n("ffad"),alt:""}}),r("input",{directives:[{name:"show",rawName:"v-show",value:!1,expression:"false"}],ref:"fileInput",attrs:{type:"file",id:"file-input",accept:"image/*"},on:{change:t.readURL}}),r("div",{staticClass:"ml-main"},[r("img",{directives:[{name:"show",rawName:"v-show",value:t.originImg,expression:"originImg"}],ref:"inputImg",attrs:{src:n("37f7"),alt:""}}),r("canvas",{ref:"overlay",attrs:{id:"overlay"}})]),r("div",{staticClass:"btn-group"},[r("button",{on:{click:t.upload}},[t._v("上传图片")]),t.saveBtn?r("button",{on:{click:t.save}},[t._v("保存图片")]):t._e()]),t.loading?r("div",{staticClass:"loading-main",attrs:{id:"loading"}},[r("div",{staticClass:"loading-div"},[r("img",{staticClass:"loading-icon",attrs:{src:n("cae3")}}),t._v(" "+t._s(t.loading_font)+"··· ")])]):t._e()])},d=[],p=(n("96cf"),n("1da1")),h=n("ab39"),g=(n("d81d"),function(t){return t[Math.floor(t.length/2)]}),v=function(t,e){return{x:(t.x+e.x)/2,y:(t.y+e.y)/2}},m=function(t,e){return Math.sqrt(Math.pow(t.x-e.x,2)+Math.pow(t.y-e.y,2))},b=function(t,e){return v(t[t.length-1],e[0])},w=function(t){return g(t)},y=function(t,e){return 5*m(t,e)/3},x=function(t,e,n,r){return Math.abs(e*t.y+n*t.x+r)/Math.sqrt(e*e+n*n)},O=function(t,e,n){var r=M(e,n),a=e.x-r*e.y,i=x(t[0],r,-1,a),o=m(t[t.length-1],r,-1,a);return i>o?2*o:2*i},j=function(t,e){return Math.PI-Math.atan2(t.x-e.x,t.y-e.y)},_=function(t,e,n){var r=-Math.sqrt(e*e/(1+t*t))+n.y,a=t*(r-n.y)+n.x;return{x:a,y:r}},P=function(t,e){var n=M(t,e),r=m(t,e);return _(n,r/2,t)},M=function(t,e){return(t.x-e.x)/(t.y-e.y)};function k(t){function e(t,e,n){var r=b(t,e),a=w(n),i=j(r,a),o=P(r,a),c=y(w(n),r),s=O(n,a,r);return{midPointOfEyebrows:r,jawPos:a,headPos:o,angle:i,faceWidth:s,faceLength:c}}return t.map((function(t){var n=t.landmarks,r=n.getRightEyeBrow(),a=n.getLeftEyeBrow(),i=n.getJawOutline();return e(a,r,i)}))}n("a4d3"),n("4de4"),n("e439"),n("dbb4"),n("b64b"),n("159b");var R=n("ade3");function I(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(t);e&&(r=r.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),n.push.apply(n,r)}return n}function D(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{};e%2?I(Object(n),!0).forEach((function(e){Object(R["a"])(t,e,n[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):I(Object(n)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(n,e))}))}return t}var E=function(t,e,n){console.log(t);var r={width:t/.6,height:.65*t/.6};return D({},r,{x:e-62*r.width/200,y:n-60*r.height/120})};function F(t,e){var n=new Image;n.setAttribute("crossOrigin","anonymous"),n.src=t,n.onload=function(){return e(n)}}function L(t,e,n){var r=e.headPos,a=e.angle,i=e.faceWidth;F(n,(function(e){console.log(e),t.save(),t.translate(r.x,r.y),t.rotate(a);var n=E(i,0,0),o=n.x,c=n.y,s=n.width,u=n.height;t.drawImage(e,o,c,s,u),t.restore()}))}function S(t,e,n){var r=e.info,a=e.width,i=void 0===a?200:a,o=e.height,c=void 0===o?200:o,s=e.imgSrc,u=t.getContext("2d");u.clearRect(0,0,i,c),F(s,(function(t){u.drawImage(t,0,0,i,c)}));for(var f=0,l=r.length;f<l;f++)L(u,r[f],n)}var C="/models",$="ssd_mobilenetv1",N="tiny_face_detector",B=$,U={data:function(){return{loading:!0,loading_font:"",originImg:!0,saveBtn:!1}},methods:{upload:function(){this.$refs.fileInput.click()},save:function(){var t=this.$refs.overlay,e=t.toDataURL("image/png");this.saveFile(e,"avatar.png")},saveFile:function(t,e){var n=document.createElementNS("http://www.w3.org/1999/xhtml","a");n.href=t,n.download=e;var r=document.createEvent("MouseEvents");r.initMouseEvent("click",!0,!1,window,0,0,0,0,0,!1,!1,!1,!1,0,null),n.dispatchEvent(r)},readURL:function(t){var e=this;if(t.target.files&&t.target.files[0]){var n=new FileReader;n.onload=function(t){e.$refs.inputImg.src=t.target.result,e.updateResults()},n.readAsDataURL(t.target.files[0])}else alert("错误")},isFaceDetectionModelLoaded:function(){return!!this.getCurrentFaceDetectionNet().params},updateResults:function(){var t=Object(p["a"])(regeneratorRuntime.mark((function t(){var e,n,r,a,i,o;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:if(this.loading=!0,this.loading_font="正在识别图像···",e=this.$refs.overlay,n=this.$refs.inputImg,this.isFaceDetectionModelLoaded()){t.next=6;break}return t.abrupt("return");case 6:return t.next=8,h["a"](n).withFaceLandmarks();case 8:r=t.sent,h["d"](e,n),a=h["f"](r,n),i=k(a),h["b"].drawFaceLandmarks(e,a),o=this.$refs.hatimg.src,this.loading_font="正在绘制图像···",this.loading=!1,this.originImg=!1,S(e,{info:i,imgSrc:n.src,width:e.width,height:e.height},o),this.saveBtn=!0;case 19:case"end":return t.stop()}}),t,this)})));function e(){return t.apply(this,arguments)}return e}(),getCurrentFaceDetectionNet:function(){return B===$?h["e"].ssdMobilenetv1:B===N?h["e"].tinyFaceDetector:void 0},run:function(){var t=Object(p["a"])(regeneratorRuntime.mark((function t(){return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return this.loading_font="正在载入模型···",t.next=3,this.getCurrentFaceDetectionNet().load(C);case 3:return t.next=5,h["c"](C);case 5:this.updateResults();case 6:case"end":return t.stop()}}),t,this)})));function e(){return t.apply(this,arguments)}return e}()},mounted:function(){this.run()}},q=U,J=(n("be28"),Object(o["a"])(q,l,d,!1,null,"35efb73c",null)),T=J.exports;r["a"].use(f["a"]);var A=new f["a"]({mode:"hash",base:"",routes:[{path:"/",name:"home",component:T}]});r["a"].config.productionTip=!1,new r["a"]({router:A,render:function(t){return t(u)}}).$mount("#app")},"5c0b":function(t,e,n){"use strict";var r=n("9c0c"),a=n.n(r);a.a},"9c0c":function(t,e,n){},be28:function(t,e,n){"use strict";var r=n("02e4"),a=n.n(r);a.a},cae3:function(t,e,n){t.exports=n.p+"img/loading.163144a9.gif"},ffad:function(t,e,n){t.exports=n.p+"img/hat1.be073784.png"}});
//# sourceMappingURL=app.75eafe79.js.map